<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transporte Sanchez - Sistema de gestión de viajes</title>

    <style>
        #app {
            display: none;
        }

        #loading-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
        }

        #tablaCamiones tbody tr td {
            text-align: center;
            vertical-align: middle;
        }

        /* Asegura que la tabla se extienda completamente */
        .table-responsive {
            width: 100%;
        }

        #tablaCamiones {
            width: 100%;
            text-align: center;
        }

        #tablaCamiones th,
        #tablaCamiones td {
            text-align: center;
            vertical-align: middle;
        }

        /* Ajusta el ancho de las columnas para que ocupen el mismo espacio */
        #tablaCamiones th {
            width: auto;
            white-space: nowrap;
        }

        /* Centrar la paginación */
        .pagination {
            justify-content: center;
        }

        .is-invalid-date {
            border: 1px solid #dc3545 !important;
            /* Contorno rojo */
            background-image: none !important;
            /* Elimina el ícono de advertencia */
        }

        .is-valid-date {
            border: 1px solid #198754 !important;
            /* Contorno verde */
        }

        .invalid-feedback-date {
            display: none;
            color: #dc3545;
            font-size: 0.875em;
            margin-top: 5px;
        }
    </style>

    <link rel="shortcut icon" href="./assets/compiled/svg/ts-icon.svg" type="image/x-icon">
    <link rel="shortcut icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACEAAAAiCAYAAADRcLDBAAAEs2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnBob3Rvc2hvcD0iaHR0cDovL25zLmFkb2JlLmNvbS9waG90b3Nob3AvMS4wLyIKICAgIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjMzIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMzQiCiAgIGV4aWY6Q29sb3JTcGFjZT0iMSIKICAgdGlmZjpJbWFnZVdpZHRoPSIzMyIKICAgdGlmZjpJbWFnZUxlbmd0aD0iMzQiCiAgIHRpZmY6UmVzb2x1dGlvblVuaXQ9IjIiCiAgIHRpZmY6WFJlc29sdXRpb249Ijk2LjAiCiAgIHRpZmY6WVJlc29sdXRpb249Ijk2LjAiCiAgIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiCiAgIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjItMDMtMzFUMTA6NTA6MjMrMDI6MDAiPgogICA8eG1wTU06SGlzdG9yeT4KICAgIDxyZGY6U2VxPgogICAgIDxyZGY6bGkKICAgICAgc3RFdnQ6YWN0aW9uPSJwcm9kdWNlZCIKICAgICAgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWZmaW5pdHkgRGVzaWduZXIgMS4xMC4xIgogICAgICBzdEV2dDp3aGVuPSIyMDIyLTAzLTMxVDEwOjUwOjIzKzAyOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5V57uAAAABgmlDQ1BzUkdCIElFQzYxOTY2LTIuMQAAKJF1kc8rRFEUxz9maORHo1hYKC9hISNGTWwsRn4VFmOUX5uZZ36oeTOv954kW2WrKLHxa8FfwFZZK0WkZClrYoOe87ypmWTO7dzzud97z+nec8ETzaiaWd4NWtYyIiNhZWZ2TvE946WZSjqoj6mmPjE1HKWkfdxR5sSbgFOr9Ll/rXoxYapQVik8oOqGJTwqPL5i6Q5vCzeo6dii8KlwpyEXFL519LjLLw6nXP5y2IhGBsFTJ6ykijhexGra0ITl5bRqmWU1fx/nJTWJ7PSUxBbxJkwijBBGYYwhBgnRQ7/MIQIE6ZIVJfK7f/MnyUmuKrPOKgZLpEhj0SnqslRPSEyKnpCRYdXp/9++msneoFu9JgwVT7b91ga+LfjetO3PQ9v+PgLvI1xkC/m5A+h7F32zoLXug38dzi4LWnwHzjeg8UGPGbFfySvuSSbh9QRqZ6H+Gqrm3Z7l9zm+h+iafNUV7O5Bu5z3L/wAdthn7QIme0YAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAJTSURBVFiF7Zi9axRBGIefEw2IdxFBRQsLWUTBaywSK4ubdSGVIY1Y6HZql8ZKCGIqwX/AYLmCgVQKfiDn7jZeEQMWfsSAHAiKqPiB5mIgELWYOW5vzc3O7niHhT/YZvY37/swM/vOzJbIqVq9uQ04CYwCI8AhYAlYAB4Dc7HnrOSJWcoJcBS4ARzQ2F4BZ2LPmTeNuykHwEWgkQGAet9QfiMZjUSt3hwD7psGTWgs9pwH1hC1enMYeA7sKwDxBqjGnvNdZzKZjqmCAKh+U1kmEwi3IEBbIsugnY5avTkEtIAtFhBrQCX2nLVehqyRqFoCAAwBh3WGLAhbgCRIYYinwLolwLqKUwwi9pxV4KUlxKKKUwxC6ZElRCPLYAJxGfhSEOCz6m8HEXvOB2CyIMSk6m8HoXQTmMkJcA2YNTHm3congOvATo3tE3A29pxbpnFzQSiQPcB55IFmFNgFfEQeahaAGZMpsIJIAZWAHcDX2HN+2cT6r39GxmvC9aPNwH5gO1BOPFuBVWAZue0vA9+A12EgjPadnhCuH1WAE8ivYAQ4ohKaagV4gvxi5oG7YSA2vApsCOH60WngKrA3R9IsvQUuhIGY00K4flQG7gHH/mLytB4C42EgfrQb0mV7us8AAMeBS8mGNMR4nwHamtBB7B4QRNdaS0M8GxDEog7iyoAguvJ0QYSBuAOcAt71Kfl7wA8DcTvZ2KtOlJEr+ByyQtqqhTyHTIeB+ONeqi3brh+VgIN0fohUgWGggizZFTplu12yW8iy/YLOGWMpDMTPXnl+Az9vj2HERYqPAAAAAElFTkSuQmCC"
        type="image/png">



    <link rel="stylesheet" href="./assets/compiled/css/app.css">
    <link rel="stylesheet" href="./assets/compiled/css/iconly.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
</head>

<body>

    <div id="loading-message" style="display: none;">
        <div class="spinner-border" role="status" style="width: 50px; height: 50px;">
            <span class="visually-hidden">Cargando...</span>
        </div>
    </div>

    <script src="assets/static/js/initTheme.js"></script>
    <div id="app">
        <div id="sidebar">

            <!--Barra lateral activa-->

            <div class="sidebar-wrapper active">
                <div class="sidebar-header position-relative">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="logo">
                            <a href="index.html"><img src="./assets/compiled/svg/ts-logo-text.svg" alt="Logo" srcset
                                    style="width: 240px; height: 160px"></a>
                        </div>
                        <div class="sidebar-toggler  x">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>

                <!--Menú-->
                <div class="sidebar-menu">
                    <ul class="menu">

                        <li class="sidebar-item ">
                            <a href="index.html" class='sidebar-link'>
                                <i class="bi bi-grid-fill"></i>
                                <span>Dashboard</span>
                            </a>


                        </li>

                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-file-earmark-person"></i>
                                <span>Choferes</span>
                            </a>

                            <ul class="submenu">

                                <li class="submenu-item">
                                    <a href="listado-choferes.html" class="submenu-link">Listar choferes</a>

                                </li>

                                <li class="submenu-item  ">
                                    <a href="gestion-choferes.html" class="submenu-link">Gestionar choferes</a>

                                </li>


                            </ul>


                        </li>

                        <li class="sidebar-item active  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-truck"></i>
                                <span>Camiones</span>
                            </a>

                            <ul class="submenu">

                                <li class="submenu-item">
                                    <a href="listado-camiones.html" class="submenu-link">Listar camiones</a>

                                </li>

                                <li class="submenu-item active">
                                    <a href="gestion-camiones.html" class="submenu-link">Gestionar camiones</a>
                                </li>

                            </ul>


                        </li>

                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-calendar-check"></i>
                                <span>Viajes</span>
                            </a>

                            <ul class="submenu">
                                <li class="submenu-item">
                                    <a href="listado-viajes.html" class="submenu-link">Listar viajes</a>

                                </li>
                                <li class="submenu-item">
                                    <a href="gestion-viajes.html" class="submenu-link">Gestionar viajes</a>

                                </li>
                                <li class="submenu-item">
                                    <a href="#" class="submenu-link">Gestionar orígenes y destinos</a>

                                </li>
                                <li class="submenu-item">
                                    <a href="#" class="submenu-link">Gestionar tarifas</a>

                                </li>
                            </ul>


                        </li>

                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-person-workspace"></i>
                                <span>Clientes</span>
                            </a>

                            <ul class="submenu">

                                <li class="submenu-item">
                                    <a href="#" class="submenu-link">Listar clientes</a>

                                </li>

                                <li class="submenu-item ">
                                    <a href="gestion-clientes.html" class="submenu-link">Gestionar clientes</a>
                                </li>

                            </ul>


                        </li>

                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-file-earmark-medical"></i>
                                <span>Facturación</span>
                            </a>

                            <ul class="submenu">

                                <li class="submenu-item">
                                    <a href="#" class="submenu-link">Listar facturas</a>

                                </li>

                                <li class="submenu-item ">
                                    <a href="#" class="submenu-link">Gestionar facturas</a>
                                </li>

                            </ul>


                        </li>

                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-people-fill"></i>
                                <span>Usuarios</span>
                            </a>

                            <ul class="submenu">

                                <li class="submenu-item">
                                    <a href="listado-usuarios.html" class="submenu-link">Listar usuarios</a>
                                </li>

                                <li class="submenu-item">
                                    <a href="gestion-usuarios.html" class="submenu-link">Gestionar usuarios</a>
                                </li>

                                <li class="submenu-item ">
                                    <a href="gestion-gruposypermisos.html" class="submenu-link">Gestionar grupos y permisos</a>
                                </li>

                            </ul>


                        </li>

                        <li class="sidebar-item  has-sub">
                            <a href="#" class='sidebar-link'>
                                <i class="bi bi-file-earmark-richtext"></i>
                                <span>Documentación</span>
                            </a>

                            <ul class="submenu">

                                <li class="submenu-item">
                                    <a href="#" class="submenu-link">Manual de usuario</a>

                                </li>

                                <li class="submenu-item ">
                                    <a href="#" class="submenu-link">Otros</a>
                                </li>

                            </ul>


                        </li>

                        <li class="sidebar-item">
                            <a href="gestion-contenido.html" class='sidebar-link' id="gestionarContenidoBtn">
                                <i class="bi bi-columns"></i>
                                <span>Gestionar contenido</span>
                            </a>

                        </li>

                    </ul>
                </div>
            </div>
        </div>

        <div id="main" class='layout-navbar navbar-fixed'>
            <!--Header-->
            <header>

                <nav class="navbar navbar-expand navbar-light navbar-top">
                    <div class="container-fluid">
                        <a href="#" class="burger-btn d-block">
                            <i class="bi bi-justify fs-3"></i>
                        </a>

                        <!--btn para expandir Menú lateral-->

                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>

                        <!--Llamado a las opciones del header-->

                        <div id="header-container"></div>

                        <script src="./assets/static/js/header.js"></script>

                    </div>
                </nav>
            </header>

            <div class="page-heading">

                <!--Comienzo sección de la tabla-->
                <section class="section">
                    <div class="card rounded me-4 ms-4 mt-4">
                        <div class="card-header">

                            <!--Notificaciones de éxito de Alta, Editar y Eliminar-->

                            <div class="position-fixed top-0 end-0 p-3" style="z-index: 1050;">
                                <div class="toast align-items-center text-white bg-success border-0" role="alert"
                                    id="alert-success" aria-live="assertive" aria-atomic="true" style="display: none;">
                                    <div class="d-flex">
                                        <div class="toast-body">
                                        </div>
                                        <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                            data-bs-dismiss="toast" aria-label="Close"></button>
                                    </div>
                                </div>
                            </div>

                            <!-- Notificación de error -->
                            <div id="toastError"
                                class="toast align-items-center text-white bg-danger border-0 position-fixed top-0 end-0 m-3"
                                role="alert" aria-live="assertive" aria-atomic="true" style="z-index: 1050;">
                                <div class="d-flex">
                                    <div id="toastErrorMessage" class="toast-body">
                                        <!-- Mensaje dinámico se inserta acá -->
                                    </div>
                                    <button type="button" class="btn-close btn-close-white me-2 m-auto"
                                        data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                            </div>

                            <h5 class="card-title">
                                Gestionar camiones
                            </h5>
                        </div>

                        <div class="card-body">
                            <form id="busquedaCamionForm" class="form">
                                <div class="row">
                                    <div class="col-md-6 mb-4">
                                        <fieldset class="border p-4">
                                            <div class="row">

                                                <!-- Input Dominio -->
                                                <div class="col-md-6 mb-3">
                                                    <label for="dominioinput">Dominio</label>
                                                    <input type="text" class="form-control" id="dominioinput"
                                                        placeholder="ABC123 o AB123CD">
                                                </div>

                                                <!-- Input Fecha de Alta -->
                                                <div class="col-md-6 mb-3">
                                                    <label for="fechaRango">Fecha de alta</label>
                                                    <input type="text" class="form-control" id="fechaRango"
                                                        placeholder="Desde y hasta">
                                                </div>
                                            </div>
                                            <div class="row">
                                                <!-- Botón Buscar -->
                                                <div class="col-md-12 mb-3 text-end">
                                                    <button type="button" class="btn btn-light"
                                                        onclick="buscarCamiones()">
                                                        Buscar
                                                    </button>
                                                </div>
                                            </div>
                                        </fieldset>
                                    </div>

                                    <!-- Botón Alta -->
                                    <div class="col-md-6 mb-4">
                                        <div class="row">
                                            <div class="col-md-12 mb-4 text-end">
                                                <button type="button" class="btn btn-success"
                                                    onclick="abrirModalAltaCamion()" data-bs-toggle="tooltip"
                                                    data-bs-placement="top" title="Registrar camión">
                                                    <i class="bi bi-truck"></i>
                                                    <i class="bi bi-plus"></i>
                                                </button>
                                                <label>&nbsp;</label>
                                                <button type="button" class="btn btn-secondary"
                                                    onclick="generarReporteCSV()" data-bs-toggle="tooltip"
                                                    data-bs-placement="top" title="Generar reporte">
                                                    <i class="bi bi-download"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>

                            <div class="table-responsive">
                                <table class="table table-striped" id="tablaCamiones">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Fecha de alta</th>
                                            <th>Dominio</th>
                                            <th>Marca</th>
                                            <th>Modelo</th>
                                            <th>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>

                            <!-- Paginación -->
                            <nav>
                                <ul class="pagination justify-content-end" id="pagination">
                                </ul>
                            </nav>
                        </div>
                    </div>
                </section>
            </div>

            <!--Fin sección de la tabla-->

            <!--Footer-->

            <footer>
                <div id="footer-container"></div>

                <script src="./assets/static/js/footer.js"></script>

            </footer>
        </div>
    </div>

    <!-- Alta Modal -->
    <div class="modal fade text-left" id="ModalAltaCamion" tabindex="-1" role="dialog"
        aria-labelledby="ModalAltaCamionlabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="ModalAltaCamionlabel">Registrar camión nuevo</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="alertaCompletaCampos" class="alert alert-light-danger color-danger" style="display: none;"
                        role="alert">
                    </div>
                    <form class="form" id="FormAltaCamion">
                        <div class="row">
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="txtDominio" class="form-label">Dominio<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="txtDominio" class="form-control"
                                        placeholder="ABC123 o AB123CD" name="dom-column" />
                                    <div id="dominioError" class="invalid-feedback" style="display: none;"></div>
                                </div>
                                <div class="form-group">
                                    <label for="txtMarca" class="form-label">Marca<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="txtMarca" class="form-control" placeholder="Renault"
                                        name="m-column" />
                                </div>
                                <div class="form-group">
                                    <label for="txtModelo" class="form-label">Modelo<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="txtModelo" class="form-control" placeholder="17.250 E"
                                        name="mo-column" />
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="txtañoModelo" class="form-label">Año del modelo <span
                                            class="text-danger"> *</span></label>
                                    <input type="number" id="txtañoModelo" class="form-control" name="y-column"
                                        placeholder="2006" />
                                    <div id="añoModeloError" class="invalid-feedback" style="display: none;"></div>
                                </div>
                                <div class="form-group">
                                    <label for="txtTipo" class="form-label">Tipo<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="txtTipo" class="form-control" name="ty-column"
                                        placeholder="Vehículo de carga" />
                                </div>
                                <div class="form-group">
                                    <label for="txtnumMotor" class="form-label">Número de motor<span
                                            class="text-danger"> *</span></label>
                                    <input type="text" id="txtnumMotor" class="form-control" name="nm-column"
                                        placeholder="K4MJ999AB99999999" />
                                    <div id="motorError" class="invalid-feedback" style="display: none;"></div>
                                </div>
                                <div class="form-group">
                                    <label for="txtnumChasis" class="form-label">Número de chasis<span
                                            class="text-danger"> *</span></label>
                                    <input type="text" id="txtnumChasis" class="form-control" name="nc-column"
                                        placeholder="9CDN8247CR2401010" />
                                    <div id="chasisError" class="invalid-feedback" style="display: none;"></div>
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="txtfechaCompra" class="form-label">Fecha de compra<span
                                            class="text-danger"> *</span></label>
                                    <input type="date" id="txtfechaCompra" class="form-control" name="fechaCompra" />
                                    <div id="fechaCompraError" class="invalid-feedback-date" style="display: none;">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="txtfechaITV" class="form-label">Fecha de ITV<span class="text-danger">
                                            *</span></label>
                                    <input type="date" id="txtfechaITV" class="form-control" name="fechaITV" />
                                    <div id="fechaITVError" class="invalid-feedback-date" style="display: none;"></div>
                                </div>
                                <div class="form-group">
                                    <label for="txtequipoFrio" class="form-label">Equipo de frío</label>
                                    <input type="text" id="txtequipoFrio" class="form-control"
                                        placeholder="Caja cerrada isotérmica" name="e-column" />
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
                        <i class="bx bx-x d-block d-sm-none"></i>
                        <span class="d-none d-sm-block">Cancelar</span>
                    </button>
                    <button type="submit" class="btn btn-primary ms-1" id="confirmarBtn">
                        <i class="bx bx-check d-block d-sm-none"></i>
                        <span class="d-none d-sm-block">Confirmar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal fade text-left" id="editarCamionModal" tabindex="-1" role="dialog"
        aria-labelledby="editarCamionModallabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" id="editarCamionModallabel">Editar datos del camión</h4>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="alertaCompletaCamposEdicion" class="alert alert-light-danger color-danger"
                        style="display: none;" role="alert">
                    </div>
                    <form class="form" id="FormEditarCamion">
                        <div class="row">
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="editarDominio" class="form-label">Dominio<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="editarDominio" class="form-control"
                                        placeholder="ABC123 o AB123CD" name="dom-column" />
                                </div>
                                <div class="form-group">
                                    <label for="editarMarca" class="form-label">Marca<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="editarMarca" class="form-control" placeholder="Renault"
                                        name="m-column" />
                                </div>
                                <div class="form-group">
                                    <label for="editarModelo" class="form-label">Modelo<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="editarModelo" class="form-control" placeholder="17.250 E"
                                        name="mo-column" />
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="editarañoModelo" class="form-label">Año del modelo <span
                                            class="text-danger"> *</span></label>
                                    <input type="number" id="editarañoModelo" class="form-control" name="y-column"
                                        placeholder="2006" data-parsley-required="false" />
                                </div>
                                <div class="form-group">
                                    <label for="editarTipo" class="form-label">Tipo<span class="text-danger">
                                            *</span></label>
                                    <input type="text" id="editarTipo" class="form-control" name="ty-column"
                                        placeholder="Vehículo de carga" />
                                </div>
                                <div class="form-group">
                                    <label for="editarnumMotor" class="form-label">Número de
                                        motor<span class="text-danger"> *</span></label>
                                    <input type="text" id="editarnumMotor" class="form-control" name="nm-column"
                                        placeholder="K4MJ999AB99999999" data-parsley-required="true" />
                                </div>
                                <div class="form-group">
                                    <label for="editarnumChasis" class="form-label">Número de
                                        chasis<span class="text-danger"> *</span></label>
                                    <input type="text" id="editarnumChasis" class="form-control" name="nc-column"
                                        placeholder="9CDN8247CR2401010" />
                                </div>
                            </div>
                            <div class="col-md-4 col-12">
                                <div class="form-group">
                                    <label for="editarfechaCompra" class="form-label">Fecha de
                                        compra<span class="text-danger"> *</span></label>
                                    <input type="date" id="editarfechaCompra" class="form-control"
                                        placeholder="01/01/2000" name="dc-column" />
                                </div>
                                <div class="form-group">
                                    <label for="editarfechaITV" class="form-label">Fecha de
                                        ITV<span class="text-danger"> *</span></label>
                                    <input type="date" id="editarfechaITV" class="form-control" placeholder="01/01/2000"
                                        name="di-column" />
                                </div>
                                <div class="form-group">
                                    <label for="editarequipoFrio" class="form-label">Equipo de
                                        frío</label>
                                    <input type="text" id="editarequipoFrio" class="form-control"
                                        placeholder="Caja cerrada isotérmica" name="e-column" />
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
                        <i class="bx bx-x d-block d-sm-none"></i>
                        <span class="d-none d-sm-block">Cancelar</span>
                    </button>
                    <button type="submit" class="btn btn-primary ms-1" id="confirmarEdicion">
                        <i class="bx bx-check d-block d-sm-none"></i>
                        <span class="d-none d-sm-block">Confirmar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de confirmación de eliminación -->
    <div class="modal fade text-left" id="confirmarEliminarModal" tabindex="-1" role="dialog"
        aria-labelledby="confirmarEliminarLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmarEliminarLabel">Confirmar eliminación</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <i data-feather="x"></i>
                    </button>
                </div>
                <div class="modal-body">
                    ¿Estás seguro que querés eliminar este camión de forma definitiva?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
                        <i class="bx bx-x d-block d-sm-none"></i>
                        <span class="d-none d-sm-block">Cancelar</span>
                    </button>
                    <button type="button" class="btn btn-danger ms-1" onclick="confirmarEliminarCamion()">
                        <i class="bx bx-check d-block d-sm-none"></i>
                        <span class="d-none d-sm-block">Confirmar</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!--Scripts-->
    <script src="assets/extensions/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/compiled/js/app.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="./assets/static/gestionContenido.js"></script>

    <!-- Comportamiento tooltip -->
    <script>
        $(document).ready(function () {
            // Inicializa tooltips en todos los elementos estáticos
            $('[data-bs-toggle="tooltip"]').tooltip();

            // Aplica tooltips a elementos dinámicamente agregados en la tabla
            $(document).on('mouseenter', '[data-bs-toggle="tooltip"]', function () {
                $(this).tooltip('show');
            });

            $(document).on('mouseleave', '[data-bs-toggle="tooltip"]', function () {
                $(this).tooltip('hide');
            });

            // Manejo específico para tooltips en botones deshabilitados
            $(document).on('mouseenter', 'span[data-bs-toggle="tooltip"]', function () {
                $(this).tooltip('show');
            });

            $(document).on('mouseleave', 'span[data-bs-toggle="tooltip"]', function () {
                $(this).tooltip('hide');
            });
        });

    </script>

    <!-- Carga de diseño y roles -->
    <script>
        window.onload = function () {
            const loadingMessage = document.getElementById('loading-message');
            loadingMessage.style.display = 'block';
            document.getElementById('app').style.display = 'none';

            // Cargar header, footer y configuración
            window.loadHeader();
            window.loadFooter();

            loadSettings()
                .then(() => {
                    adjustVisibilityBasedOnRole();
                    loadingMessage.style.display = 'none';
                    document.getElementById('app').style.display = 'block';
                })
                .catch((error) => {
                    console.error('Error al cargar el header, footer o los datos:', error);
                    loadingMessage.innerText = 'Error al cargar el header, footer o los datos.';
                });
        };

        function adjustVisibilityBasedOnRole() {
            const userRole = localStorage.getItem('userRole');
            const gestionarContenidoBtn = document.getElementById('gestionarContenidoBtn');

            if (userRole && userRole.toLowerCase() === 'admin') {
                gestionarContenidoBtn.style.display = 'block';
            } else {
                gestionarContenidoBtn.style.display = 'none';
            }
        }

        async function loadSettings() {
            return new Promise((resolve, reject) => {
                const xhr = new XMLHttpRequest();
                xhr.open('GET', 'http://localhost:50222/api/GestionContenido/1', true);

                xhr.onload = function () {
                    if (xhr.status >= 200 && xhr.status < 300) {
                        const data = JSON.parse(xhr.responseText);
                        if (data) {
                            const { Logo: logoUrl, ColorFondo: colorFondo, ColorBotonesMenu: colorBotonesMenu, ContenidoPiePagina: contenidoPiePagina } = data;

                            applyStyles(logoUrl, colorFondo, colorBotonesMenu, contenidoPiePagina);
                            resolve();
                        } else {
                            console.error('La respuesta de la API no contiene los datos esperados.');
                            reject(new Error('Datos vacíos o inexistentes en la respuesta de la API'));
                        }
                    } else {
                        console.error('Error en la petición:', xhr.statusText);
                        reject(new Error('Error en la carga de la API'));
                    }
                };

                xhr.onerror = function () {
                    console.error('Error al cargar la configuración de la API.');
                    reject(new Error('Error de red'));
                };

                xhr.send();
            });
        }


    </script>

    <!-- Buscador y listar -->
    <script>

        $('#dominioinput').on('input', function (event) {
            // Reemplaza cualquier carácter que no sea una letra o un número
            this.value = this.value.replace(/[^A-Za-z0-9]/g, '');
            // Limita la longitud a 7 caracteres
            if (this.value.length > 7) {
                this.value = this.value.slice(0, 7);
            }
        });

        // Evento para ejecutar la búsqueda automáticamente al borrar un campo de entrada
        $('#dominioinput').on('input', function () {
            if ($(this).val().trim() === '') {
                buscarCamiones();
            }
        });

        function formatDate(isoDate) {
            var date = new Date(isoDate);
            var day = String(date.getDate()).padStart(2, '0');
            var month = String(date.getMonth() + 1).padStart(2, '0');
            var year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }


        // Constantes para el paginado
        const pageSize = 6;
        let currentPage = 1;

        // Función para realizar la búsqueda de choferes con paginación
        function buscarCamiones(page = 1) {
            // Obtener el valor del campo de búsqueda
            var dominio = $('#dominioinput').val();
            var fechaDesde = $('#fechaRango').data('start');
            var fechaHasta = $('#fechaRango').data('end');

            var requestData = {
                dominio: dominio,
                fechaDesde: fechaDesde || null,  // Agregar fecha desde si existe
                fechaHasta: fechaHasta || null,  // Agregar fecha hasta si existe
                page: page,
                pageSize: pageSize
            };

            // Agregar los parámetros de búsqueda al objeto de datos si tienen un valor
            if (dominio !== '') requestData.dominio = dominio;
            if (fechaDesde) requestData.fechaDesde = fechaDesde;
            if (fechaHasta) requestData.fechaHasta = fechaHasta;

            // Realizar la solicitud AJAX GET al controlador
            $.ajax({
                url: 'http://localhost:50222/api/Camiones/Buscar',
                type: 'GET',
                data: requestData,
                success: function (data) {
                    // Limpiar la tabla antes de agregar nuevos registros
                    $('#tablaCamiones tbody').empty();

                    // Verificar si hay resultados
                    if (data.Results.length === 0) {
                        // Mostrar mensaje de que no se encontraron registros
                        $('#tablaCamiones tbody').html('<tr><td colspan="6" class="text-center">No se encontraron registros</td></tr>');
                    } else {
                        // Iterar sobre los registros recibidos y agregarlos a la tabla
                        data.Results.forEach(function (registro) {

                            // Formatear las fechas
                            var fechaCompra = formatDate(registro.FechaCompra);
                            var fechaITV = formatDate(registro.FechaITV);
                            var fechaAltaFormateada = formatFechaUTC3(registro.Fecha_Alta);

                            // Construir la fila de la tabla con los botones de editar y eliminar
                            var row = `
                    <tr>
                            <td>${registro.Camion_ID}</td>
                            <td>${fechaAltaFormateada}</td>
                            <td>${registro.Dominio.trim()}</td>
                            <td>${registro.Marca}</td>
                            <td>${registro.Modelo}</td>
                        <td>
                            <button class="btn btn-primary" 
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="top" 
                                    title="Editar"
                                    onclick="abrirModalEdicion(${registro.Camion_ID})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-danger ms-1" 
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="top" 
                                    title="Eliminar"
                                    onclick="abrirModalEliminar(${registro.Camion_ID})">
                                    <i class="bi bi-trash"></i>
                                </button>
                        </td>
                    </tr>`;

                            // Agregar la fila construida a la tabla de camiones
                            $('#tablaCamiones tbody').append(row);
                        });
                    }

                    // Renderizar la paginación
                    renderPagination(data.TotalRecords, pageSize, page);
                },
                error: function (xhr, status, error) {
                    // Manejar errores de la solicitud
                    console.error(error);
                }
            });

        }

        // Función para datepicker de rango de fechas
        $(document).ready(function () {
            $('#fechaRango').daterangepicker({
                autoUpdateInput: false,
                locale: {
                    cancelLabel: 'Borrar',
                    format: 'DD/MM/YYYY',
                    applyLabel: 'Aplicar',
                    cancelLabel: 'Cancelar',
                    daysOfWeek: ['Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'Sa'],
                    monthNames: [
                        'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                        'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
                    ]
                }
            });

            // Evento cuando se selecciona un rango de fechas
            $('#fechaRango').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('DD/MM/YYYY') + ' - ' + picker.endDate.format('DD/MM/YYYY'));
                $(this).data('start', picker.startDate.format('YYYY-MM-DD'));
                $(this).data('end', picker.endDate.format('YYYY-MM-DD'));
            });

            // Evento cuando se borra la fecha seleccionada (botón "Borrar" del datepicker)
            $('#fechaRango').on('cancel.daterangepicker', function () {
                $(this).val('');
                $(this).removeData('start').removeData('end');
                buscarCamiones();
            });

            // Evento adicional para detectar eliminación manual del input
            $('#fechaRango').on('input', function () {
                if ($(this).val().trim() === '') {
                    $(this).removeData('start').removeData('end');
                    buscarCamiones();
                }
            });
        });

        // Función para formatear la fecha en DD/MM/YYYY hh:mm con UTC-3
        function formatFechaUTC3(isoDate) {
            const date = new Date(isoDate);
            const utc3Date = new Date(date.getTime() - 3 * 60 * 60 * 1000);

            const day = String(utc3Date.getDate()).padStart(2, '0');
            const month = String(utc3Date.getMonth() + 1).padStart(2, '0');
            const year = utc3Date.getFullYear();
            const hours = String(utc3Date.getHours()).padStart(2, '0');
            const minutes = String(utc3Date.getMinutes()).padStart(2, '0');

            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }

        // Función para renderizar la paginación
        function renderPagination(totalRecords, pageSize, currentPage) {
            const totalPages = Math.ceil(totalRecords / pageSize);
            const paginationContainer = $('#pagination');
            paginationContainer.empty();

            const prevDisabled = currentPage === 1 ? 'disabled' : '';
            const nextDisabled = currentPage === totalPages ? 'disabled' : '';

            paginationContainer.append(`
        <li class="page-item ${prevDisabled}">
            <a class="page-link" href="#" aria-label="Previous" onclick="buscarCamiones(${currentPage - 1})">
                <span aria-hidden="true"><i class="bi bi-chevron-left"></i></span>
            </a>
        </li>
    `);

            for (let i = 1; i <= totalPages; i++) {
                const activeClass = currentPage === i ? 'active' : '';
                paginationContainer.append(`
            <li class="page-item ${activeClass}">
                <a class="page-link" href="#" onclick="buscarCamiones(${i})">${i}</a>
            </li>
        `);
            }

            paginationContainer.append(`
        <li class="page-item ${nextDisabled}">
            <a class="page-link" href="#" aria-label="Next" onclick="buscarCamiones(${currentPage + 1})">
                <span aria-hidden="true"><i class="bi bi-chevron-right"></i></span>
            </a>
        </li>
    `);
        }

        // Función para abrir el modal de edición
        function abrirModalEdicion(camionId) {
            // Llamada a la función para cargar los datos
            editarCamion(camionId);
            $('#editarCamionModal').modal('show');
        }

        // Función para abrir el modal de eliminación
        function abrirModalEliminar(camionId) {
            $('#confirmarEliminarModal').modal('show');
            setEliminarCamionId(camionId);
        }

        $(document).ready(function () {
            // Ejecutar la búsqueda inicial al cargar la página
            buscarCamiones(currentPage);
        });

    </script>

    <!-- Alta -->
    <script>
        $(document).ready(function () {
            // Selección de los campos requeridos
            const camposRequeridos = [
                '#txtDominio',
                '#txtMarca',
                '#txtModelo',
                '#txtañoModelo',
                '#txtTipo',
                '#txtfechaCompra',
                '#txtfechaITV',
                '#txtnumMotor',
                '#txtnumChasis'
            ];

            // Función para abrir el modal de alta de camiones
            window.abrirModalAltaCamion = function () {
                $('#ModalAltaCamion').modal('show');
            };


            // Función para validar campos requeridos
            function validarCamposRequeridos() {
                let camposIncompletos = false;

                camposRequeridos.forEach(function (campo) {
                    const input = $(campo);
                    if (input.val().trim() === '') {
                        input.addClass('is-invalid');
                        camposIncompletos = true;
                    } else {
                        input.removeClass('is-invalid');
                    }
                });

                if (camposIncompletos) {
                    $('#alertaCompletaCampos')
                        .text('Por favor, completá todos los campos requeridos.')
                        .show();
                } else {
                    $('#alertaCompletaCampos').hide();
                }

                return !camposIncompletos;
            }

            // Función para validar un campo individual
            function validarCampoIndividual(input) {
                if (input.val().trim() === '') {
                    input.addClass('is-invalid');
                } else {
                    input.removeClass('is-invalid');
                    input.trigger('blur'); // Activar validación específica
                }
            }

            // Ocultar alerta y errores cuando se empieza a escribir en cualquier campo
            camposRequeridos.forEach(function (campo) {
                $(campo).on('input', function () {
                    // Ocultar la alerta de campos incompletos
                    $('#alertaCompletaCampos').hide();

                    // Remover errores de todos los campos
                    camposRequeridos.forEach(function (c) {
                        $(c).removeClass('is-invalid');
                    });

                    // Ocultar todos los mensajes de error
                    $('.invalid-feedback, .invalid-feedback-date').hide();
                });
            });

            $('#txtDominio').on('input', function () {
                var maxLength = 7;
                var valor = $(this).val().toUpperCase().slice(0, maxLength);
                $(this).val(valor);
            });

            // Validaciones de Dominio
            $('#txtDominio').on('blur', function () {
                validarCampo(
                    $(this),
                    $('#dominioError'),
                    /^[A-Z]{2}[0-9]{3}[A-Z]{2}$|^[A-Z]{3}[0-9]{3}$/,
                    'El dominio debe tener el formato AA123CC o AAA123.',
                    7
                );
            });

            $('#txtañoModelo').on('input', function () {
                var valor = $(this).val().trim().slice(0, 4);
                $(this).val(valor);
            });

            // Validación del Año del Modelo
            $('#txtañoModelo').on('blur', function () {
                var currentYear = new Date().getFullYear();
                var value = $(this).val().trim();

                if (value === '') {
                    $(this).removeClass('is-invalid is-valid');
                    $('#añoModeloError').hide();
                    return;
                }

                if (!/^\d{4}$/.test(value) || parseInt(value) > currentYear) {
                    $(this).removeClass('is-valid').addClass('is-invalid');
                    $('#añoModeloError').text('El año del modelo no puede ser mayor al año actual.').show();
                } else {
                    $(this).removeClass('is-invalid').addClass('is-valid');
                    $('#añoModeloError').hide();
                }
            });

            $('#txtnumMotor, #txtnumChasis').on('input', function () {
                var maxLength = 17;
                var valor = $(this).val().toUpperCase().slice(0, maxLength);
                $(this).val(valor);
            });

            $('#txtnumMotor').on('blur', function () {
                validarCampo(
                    $(this),
                    $('#motorError'),
                    /^(?=.*[A-Z])(?=.*\d)[A-Z0-9]{1,17}$/,
                    'El número de motor debe incluir letras y números.',
                    17
                );
            });

            $('#txtnumChasis').on('blur', function () {
                validarCampo(
                    $(this),
                    $('#chasisError'),
                    /^(?=.*[A-Z])(?=.*\d)[A-Z0-9]{1,17}$/,
                    'El número de chasis debe incluir letras y números.',
                    17
                );
            });

            // Validación de fechas con mensajes personalizados
            function validarFecha(input, errorContainer, mensajeFormato, mensajeFuturo) {
                const valorFecha = input.val().trim();
                const esValida = /^\d{4}-\d{2}-\d{2}$/.test(valorFecha);
                const esFutura = new Date(valorFecha) > new Date();

                if (!esValida) {
                    input.addClass('is-invalid-date').removeClass('is-valid-date');
                    errorContainer.text(mensajeFormato).show();
                } else if (esFutura) {
                    input.addClass('is-invalid-date').removeClass('is-valid-date');
                    errorContainer.text(mensajeFuturo).show();
                } else {
                    input.removeClass('is-invalid-date').addClass('is-valid-date');
                    errorContainer.hide();
                }
            }

            $('#txtfechaCompra').on('blur', function () {
                validarFecha($(this), $('#fechaCompraError'), 'La fecha de compra no tiene un formato válido (DD-MM-YYYY).', 'La fecha de compra no puede ser futura.');
            });

            $('#txtfechaITV').on('blur', function () {
                validarFecha($(this), $('#fechaITVError'), 'La fecha de ITV no tiene un formato válido (DD-MM-YYYY).', 'La fecha de ITV no puede ser futura.');
            });

            // Limpiar validaciones al cerrar el modal
            $('#ModalAltaCamion').on('hidden.bs.modal', function () {
                camposRequeridos.forEach(function (campo) {
                    $(campo).val('').removeClass('is-invalid is-valid is-invalid-date is-valid-date');
                });

                $('.invalid-feedback, .invalid-feedback-date').text('').hide();
                $('#alertaCompletaCampos').hide();
            });

            // Evento al hacer clic en el botón "Confirmar"
            $('#confirmarBtn').on('click', function () {
                let camposValidos = true;

                camposRequeridos.forEach(function (campo) {
                    const input = $(campo);
                    validarCampoIndividual(input);
                    if (input.hasClass('is-invalid') || input.hasClass('is-invalid-date')) {
                        camposValidos = false;
                    }
                });

                if (camposValidos) {
                    registrarCamion();
                } else {
                    $('#alertaCompletaCampos').text('Por favor, completá todos los campos requeridos.').show();
                }
            });

            // Función para registrar el camión
            function registrarCamion() {
                const usuarioLogueado = localStorage.getItem('username') || 'Desconocido';
                const fechaHoraActual = new Date().toISOString();

                const nuevoCamion = {
                    Dominio: $('#txtDominio').val().trim(),
                    Marca: $('#txtMarca').val().trim(),
                    Modelo: $('#txtModelo').val().trim(),
                    AñoModelo: $('#txtañoModelo').val().trim(),
                    Tipo: $('#txtTipo').val().trim(),
                    FechaCompra: $('#txtfechaCompra').val().trim(),
                    FechaITV: $('#txtfechaITV').val().trim(),
                    NumMotor: $('#txtnumMotor').val().trim(),
                    NumChasis: $('#txtnumChasis').val().trim(),
                    EquipoFrio: $('#txtequipoFrio').val().trim(),
                    EstadoCamion: 'Activo',
                    Fecha_Alta: fechaHoraActual,
                    Usu_Alta: usuarioLogueado,
                    Fecha_Modi: fechaHoraActual,
                    Usu_Modi: usuarioLogueado
                };

                $.ajax({
                    url: 'http://localhost:50222/api/Camiones',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(nuevoCamion),
                    success: function (response) {
                        mostrarToastExito('El camión se registró exitosamente.');
                        $('#ModalAltaCamion').modal('hide');
                        buscarCamiones(currentPage); // Llamar a la búsqueda con la primera página después del registro
                    },
                    error: function (xhr, status, error) {
                        console.error('Error al agregar el camión:', error);
                    }
                });
            }

            // Función para mostrar el toast de éxito
            function mostrarToastExito(mensaje) {
                var toastElement = $('#alert-success');
                toastElement.find('.toast-body').text(mensaje);
                toastElement.show();
                var toast = new bootstrap.Toast(toastElement[0]);
                toast.show();
                setTimeout(function () {
                    toast.hide();
                }, 5000);
            }

            // Función genérica para validar campos
            function validarCampo(input, errorContainer, regex, mensajeError, maxLength) {
                var valor = input.val().trim().toUpperCase().slice(0, maxLength);
                input.val(valor); // Limita la longitud y convierte a mayúsculas

                if (valor === '') {
                    input.removeClass('is-invalid is-valid');
                    errorContainer.hide();
                    return;
                }

                if (!regex.test(valor)) {
                    input.removeClass('is-valid').addClass('is-invalid');
                    errorContainer.text(mensajeError).show();
                } else {
                    input.removeClass('is-invalid').addClass('is-valid');
                    errorContainer.hide();
                }
            }
        });
    </script>

    <!-- Editor -->
    <script>
        // Función para formatear fechas del formato ISO al formato YYYY-MM-DD
        function formatDateForInput(isoDate) {
            var date = new Date(isoDate);
            var year = date.getFullYear();
            var month = String(date.getMonth() + 1).padStart(2, '0');
            var day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Función para cargar los datos del camión en el modal de edición
        function editarCamion(id) {
            $.ajax({
                url: 'http://localhost:50222/api/Camiones/' + id,
                type: 'GET',
                success: function (data) {
                    if (data) {
                        $('#editarDominio').val(data.Dominio);
                        $('#editarMarca').val(data.Marca);
                        $('#editarModelo').val(data.Modelo);
                        $('#editarañoModelo').val(data.AñoModelo);
                        $('#editarTipo').val(data.Tipo);
                        $('#editarnumMotor').val(data.NumMotor);
                        $('#editarnumChasis').val(data.NumChasis);
                        $('#editarfechaCompra').val(formatDateForInput(data.FechaCompra));
                        $('#editarfechaITV').val(formatDateForInput(data.FechaITV));
                        $('#editarequipoFrio').val(data.EquipoFrio);

                        $('#confirmarEdicion').attr('Camion_ID', id);
                        validateAllFields(); // Validar todos los campos al cargar datos
                    } else {
                        console.error('Datos no encontrados para el camión con ID:', id);
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error al cargar los datos del camión:', error);
                    alert('Error al cargar los datos del camión. Por favor, intenta nuevamente.');
                }
            });
        }

        // Función para validar todos los campos y mostrar el mensaje de error correspondiente
        function validateAllFields() {
            var dominio = $('#editarDominio').val();
            var marca = $('#editarMarca').val();
            var modelo = $('#editarModelo').val();
            var añomodelo = $('#editarañoModelo').val();
            var tipo = $('#editarTipo').val();
            var motor = $('#editarnumMotor').val();
            var chasis = $('#editarnumChasis').val();
            var fechacompra = $('#editarfechaCompra').val();
            var fechaitv = $('#editarfechaITV').val();

            var currentYear = new Date().getFullYear();
            var fechaCompra = new Date(fechacompra);
            var fechaITV = new Date(fechaitv);

            var errorMessage = '';
            var isValid = true;

            if (!dominio || !marca || !modelo || !añomodelo || !tipo || !motor || !chasis || !fechacompra || !fechaitv) {
                errorMessage = 'Por favor, completa todos los campos requeridos *';
                isValid = false;
            } else if (añomodelo > currentYear) {
                errorMessage = 'El año del modelo no puede ser mayor al año actual (' + currentYear + ')';
                isValid = false;
            } else if (fechaCompra > new Date()) {
                errorMessage = 'La fecha de compra no puede ser una fecha futura';
                isValid = false;
            } else if (fechaITV > new Date()) {
                errorMessage = 'La fecha del ITV no puede ser una fecha futura';
                isValid = false;
            }

            if (isValid) {
                $('#alertaCompletaCamposEdicion').hide();
                $('#confirmarEdicion').prop('disabled', false);
            } else {
                $('#alertaCompletaCamposEdicion').text(errorMessage).show();
                $('#confirmarEdicion').prop('disabled', true);
            }
        }

        // Eventos para validación en tiempo real
        $('#editarañoModelo').on('input', function () {
            var currentYear = new Date().getFullYear();
            var value = this.value;

            // Limitar la entrada a 4 dígitos
            if (value.length > 4) {
                this.value = value.slice(0, 4);
            }

            // Solo considerar los primeros 4 dígitos para la validación
            var enteredYear = parseInt(this.value, 10);

            if (enteredYear > currentYear) {
                $('#alertaCompletaCamposEdicion').text('El año del modelo no puede ser mayor al año actual (' + currentYear + ')').show();
                $('#confirmarEdicion').prop('disabled', true);
            } else {
                validateAllFields();
            }
        });

        $('#editarDominio').on('input', function () {
            this.value = this.value.replace(/[^A-Za-z0-9]/g, '');
            if (this.value.length > 7) {
                this.value = this.value.slice(0, 7);
            }
            validateAllFields();
        });

        $('#editarMarca').on('input', function () {
            validateAllFields();
        });

        $('#editarModelo').on('input', function () {
            validateAllFields();
        });

        $('#editarTipo').on('input', function () {
            validateAllFields();
        });

        $('#editarnumMotor').on('input', function () {
            this.value = this.value.replace(/[^A-Za-z0-9]/g, '');
            if (this.value.length > 17) {
                this.value = this.value.slice(0, 17);
            }
            validateAllFields();
        });

        $('#editarnumChasis').on('input', function () {
            this.value = this.value.replace(/[^A-Za-z0-9]/g, '');
            if (this.value.length > 17) {
                this.value = this.value.slice(0, 17);
            }
            validateAllFields();
        });

        $('#editarfechaCompra').on('change', function () {
            validateAllFields();
        });

        $('#editarfechaITV').on('change', function () {
            validateAllFields();
        });

        // Evento click para confirmar la edición de los detalles del camión
        $('#confirmarEdicion').on('click', function (event) {
            event.preventDefault();

            validateAllFields();

            if ($('#confirmarEdicion').prop('disabled')) {
                return;
            }

            var id = $(this).attr('Camion_ID');
            var dominio = $('#editarDominio').val();
            var marca = $('#editarMarca').val();
            var modelo = $('#editarModelo').val();
            var añomodelo = $('#editarañoModelo').val();
            var tipo = $('#editarTipo').val();
            var motor = $('#editarnumMotor').val();
            var chasis = $('#editarnumChasis').val();
            var fechacompra = $('#editarfechaCompra').val();
            var fechaitv = $('#editarfechaITV').val();
            var equipofrio = $('#editarequipoFrio').val();

            var nuevoCamion = {
                Dominio: dominio,
                Marca: marca,
                Modelo: modelo,
                AñoModelo: añomodelo,
                Tipo: tipo,
                NumMotor: motor,
                NumChasis: chasis,
                FechaCompra: fechacompra,
                FechaITV: fechaitv,
                EquipoFrio: equipofrio,
            };

            $.ajax({
                url: 'http://localhost:50222/api/Camiones/' + id,
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(nuevoCamion),
                success: function (response) {
                    console.log('Camión actualizado correctamente:', response);
                    mostrarToastExito('Los datos del camión se actualizaron exitosamente');
                    $('#editarCamionModal').modal('hide');
                    buscarCamiones(); // Actualizar la lista de camiones en la pantalla
                },
                error: function (xhr, status, error) {
                    console.error('Error al actualizar el camión:', error);
                    alert('Error al actualizar el camión. Por favor, intenta nuevamente.');
                }
            });
        });

        // Limpiar el formulario y las validaciones cuando se cierra el modal
        $('#editarCamionModal').on('hidden.bs.modal', function () {
            $('#FormEditarCamion')[0].reset();
            $('#alertaCompletaCamposEdicion').hide();
            $('#confirmarEdicion').prop('disabled', false);
        });

        // Función para mostrar el toast de éxito con mensaje dinámico
        function mostrarToastExito(mensaje) {
            var toastElement = $('#alert-success');
            toastElement.find('.toast-body').text(mensaje);
            toastElement.show();
            var toast = new bootstrap.Toast(toastElement[0]);
            toast.show();
            setTimeout(function () {
                toast.hide();
            }, 5000);
        }
    </script>

    <!--Eliminar-->
    <script>

        var camionIdAEliminar;

        // Función para abrir el modal y establecer el ID del camión
        function abrirModalEliminarCamion(camionId, estadoCamion) {
            if (estadoCamion === 'Activo') {
                return; // No permitir eliminar si el camión está activo
            }
            camionIdAEliminar = camionId;
            $('#confirmarEliminarModal').modal('show');
        }

        // Función para mostrar el toast de éxito con mensaje dinámico
        function mostrarToastExito(mensaje) {
            var toastElement = $('#alert-success');
            toastElement.find('.toast-body').text(mensaje); // Establecer el texto del toast con el mensaje recibido
            toastElement.show(); // Mostrar el toast

            var toast = new bootstrap.Toast(toastElement[0]);
            toast.show(); // Mostrar el toast usando Bootstrap

            setTimeout(function () {
                toast.hide(); // Ocultar el toast después de unos segundos
            }, 5000); // Mostrar por 5 segundos
        }

        // Función para confirmar la eliminación del camión
        function confirmarEliminarCamion() {
            if (camionIdAEliminar) {
                var usuarioLogueado = localStorage.getItem('username') || "Desconocido";

                $.ajax({
                    url: 'http://localhost:50222/api/Camiones/Eliminar/' + camionIdAEliminar,
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        Usu_Modi: usuarioLogueado
                    }),
                    success: function (response) {
                        console.log('Camión marcado como eliminado:', response);
                        mostrarToastExito('El camión se eliminó exitosamente.');
                        $('#confirmarEliminarModal').modal('hide');
                        buscarCamiones(); // Refrescar la tabla
                    },
                    error: function (xhr, status, error) {
                        console.error('Error al eliminar el camión:', xhr.responseText || error);
                    }
                });
            }
        }

    </script>

    <!-- Generar reporte CSV de camiones -->
    <script>
        async function generarReporteCSV() {
            var dominio = $('#dominioinput').val() || '';
            var fechaDesde = $('#fechaRango').data('start') || null;
            var fechaHasta = $('#fechaRango').data('end') || null;

            var requestData = {
                dominio: dominio,
                fechaDesde: fechaDesde || null,
                fechaHasta: fechaHasta || null,
                page: currentPage,
                pageSize: pageSize
            };

            try {
                const response = await $.ajax({
                    url: 'http://localhost:50222/api/Camiones/Buscar',
                    type: 'GET',
                    data: requestData
                });

                if (response.Results.length === 0) {
                    mostrarToastError('No se encontraron registros para generar el reporte.');
                    return;
                }

                generarCSV(response.Results);
            } catch (error) {
                console.error('Error al generar el reporte:', error);
                mostrarToastError('Ocurrió un error al generar el reporte. Intentá de nuevo más tarde.');
            }
        }

        // Función para mostrar un toast de error con mensaje dinámico
        function mostrarToastError(mensaje) {
            $('#toastErrorMessage').text(mensaje);
            const toast = new bootstrap.Toast(document.getElementById('toastError'));
            toast.show();
        }

        // Función para generar el CSV con codificación UTF-8 con BOM
        function generarCSV(data) {
            // Definir las columnas del CSV con nombres personalizados
            const headers = [
                'Camion_ID', 'Dominio', 'Marca', 'Modelo', 'Año Modelo',
                'Tipo', 'Fecha de Compra', 'Fecha de ITV', 'Número de Motor',
                'Número de Chasis', 'Equipo de Frío', 'Estado',
                'Fecha de Alta', 'Usuario de Alta', 'Fecha de Modificación', 'Usuario de Modificación'
            ];

            let csvContent = headers.join(";") + "\n";

            data.forEach(function (registro) {
                let row = [
                    registro.Camion_ID,
                    registro.Dominio.trim(),
                    registro.Marca,
                    registro.Modelo,
                    registro.AñoModelo,
                    registro.Tipo,
                    formatFechaDDMMYYYY(registro.FechaCompra),
                    formatFechaDDMMYYYY(registro.FechaITV),
                    registro.NumMotor || '',
                    registro.NumChasis || '',
                    registro.EquipoFrio || '',
                    registro.Estado || '',
                    formatFechaUTC3(registro.Fecha_Alta),
                    registro.Usu_Alta || '',
                    registro.Fecha_Modi ? formatFechaUTC3(registro.Fecha_Modi) : '',
                    registro.Usu_Modi || ''
                ];

                csvContent += row.map(value => `"${value}"`).join(";") + "\n";
            });

            // Agregar el BOM al inicio para asegurar la codificación UTF-8
            let blob = new Blob(["\ufeff" + csvContent], { type: "text/csv;charset=utf-8;" });

            let url = URL.createObjectURL(blob);

            let a = document.createElement("a");
            a.href = url;
            a.download = "Listado_Camiones.csv";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Función para formatear la fecha en DD-MM-YYYY sin hora y minuto
        function formatFechaDDMMYYYY(isoDate) {
            if (!isoDate) return '';
            const date = new Date(isoDate);

            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();

            return `${day}-${month}-${year}`;
        }

        // Función para formatear la fecha en DD/MM/YYYY hh:mm con UTC-3
        function formatFechaUTC3(isoDate) {
            if (!isoDate) return '';
            const date = new Date(isoDate);
            const utc3Date = new Date(date.getTime() - 3 * 60 * 60 * 1000);

            const day = String(utc3Date.getDate()).padStart(2, '0');
            const month = String(utc3Date.getMonth() + 1).padStart(2, '0');
            const year = utc3Date.getFullYear();
            const hours = String(utc3Date.getHours()).padStart(2, '0');
            const minutes = String(utc3Date.getMinutes()).padStart(2, '0');

            return `${day}/${month}/${year} ${hours}:${minutes}`;
        }
    </script>


</body>


</html>